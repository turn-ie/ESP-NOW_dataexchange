[platformio]
src_dir = .
default_envs = device1

; 共通設定
[env]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; ==== シリアル関係 ====
upload_speed = 921600
monitor_speed = 115200

; ==== ライブラリ依存関係 ====
lib_deps = 
    adafruit/Adafruit GFX Library@^1.11.9
    adafruit/Adafruit NeoMatrix@^1.3.2
    adafruit/Adafruit NeoPixel@^1.12.0
    bblanchon/ArduinoJson@^6.21.4
    mathertel/OneButton

; ==== フラッシュ/パーティション ====
board_build.filesystem = littlefs
board_build.filesystem_dir = data
board_upload.flash_size = 4MB
board_build.flash_size = 4MB
; Arduino IDE設定の "Default 4MB with spiffs" に合わせるなら default.csv ですが
; LittleFSを使うのであれば、明示的にLittleFS用のパーティションを指定するか、
; default.csv を使いつつ board_build.filesystem = littlefs で上書きします。
board_build.partitions = default.csv

; PSRAM: Disabled (Arduino IDE設定に合わせる)
; board_build.psram = disabled ; デフォルトで無効なのでコメントアウトでもOK

; ==== ビルドフラグ (Arduino IDE設定に対応) ====
build_flags =
  ; USB Mode: Hardware CDC and JTAG
  -DARDUINO_USB_MODE=1
  ; USB CDC On Boot: Enabled (★重要: これでシリアルが見えるようになります)
  -DARDUINO_USB_CDC_ON_BOOT=1
  ; USB DFU On Boot: Disabled
  -DARDUINO_USB_DFU_ON_BOOT=0
  ; USB Firmware MSC On Boot: Disabled
  -DARDUINO_USB_MSC_ON_BOOT=0
  ; Core Debug Level: None
  -DCORE_DEBUG_LEVEL=0
  ; Arduino Runs On: Core 1
  -DARDUINO_RUNNING_CORE=1
  ; Events Run On: Core 1
  -DARDUINO_EVENT_RUNNING_CORE=1

; ===== デバイス1 (1301) =====
[env:device1]
upload_port = /dev/cu.usbmodem1301
monitor_port = /dev/cu.usbmodem1301

; ===== デバイス2 (1401) =====
[env:device2]
upload_port = /dev/cu.usbmodem1401
monitor_port = /dev/cu.usbmodem1401
